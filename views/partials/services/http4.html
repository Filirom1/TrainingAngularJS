<div class="bloc-content text-content">

	<h1>Main Angular services: $http</h1>

	<ul>
		<li><strong>Exercises</strong>
			<ul>
				<li>Write a function <i>asyncGetNbUsers</i>, which: 
					service to: 
					<ul>
						<li>
							Return a promise
						</li>
						<li>
					 		uses <i>$http</i> to retrieve the content of <i>data/exos/users.json</i> file
					 	</li>
					 	<li>
					 	Resolve the returned promise with the json content retrieved...
					 	</li>
					 </ul>
				</li>
				<li>Call your asyncGetTimeout() to update the $scope.nbUsers field</li>
			</ul>
	</ul>
		
	<sdco-editor compile="true" compile-js-first="true" compile-on-demand="true" >
	    <sdco-editor-tab type="html" heading="http.html">
&lt;div ng-app="sample" id="userPanel" ng-controller="UserCtrl"&gt;
    There are {{nbUsers}} connected users on the website.
&lt;/div&gt;
		</sdco-editor-tab>
		<sdco-editor-tab type="javascript" heading="http.js">
angular.module('trainingAJ')
.exoController('UserCtrl', ['$scope', '$timeout', function($scope, $timeout) {
	
	$scope.asynchGetNbUsers = function() {

	};

	//$scope.asynchGetNbUsers() &lt;- to complete
}]);

		</sdco-editor-tab>
	</sdco-editor>
</div>
<!-- 
angular.module('trainingAJ')
.exoController('UserCtrl', ['$scope', '$timeout','$http', '$q',  function($scope, $timeout, $http, $q) {
	
	$scope.asynchGetNbUsers = function() {
      
      var defered= $q.defer();
      
	  // TODO: 1) use $timeout, just to create an asynch action
      $timeout(function(){
        
		// TODO: 2) The function in the timeout has to retrieve the file data/users.json
		//			and resolve a promise when data is retrieved, or reject it in case of error        
        $http.get('data/exos/users.json')
        .then(
          function success(answer){ defered.resolve(answer.data.length);}, 
          function error(reason){defered.reject(reason);}
       	);
        
      }, 1000);

	  // TODO: 3) Don't forget to return your promise
      return defered.promise;
	};

	// TODO 4: Call $scope.asynchGetNbUsers() and update the $scope.nbUsers field...
  	$scope.asynchGetNbUsers()
    .then(function success(length){
      	console.log(length);
    	$scope.nbUsers=length;
    });
}]);
 -->
